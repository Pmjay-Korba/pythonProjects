import time

import openpyxl
from selenium import webdriver
from selenium.common import StaleElementReferenceException, ElementClickInterceptedException, TimeoutException, \
    UnexpectedAlertPresentException
from selenium.webdriver.chrome.webdriver import WebDriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.support.ui import Select
from selenium.webdriver.support.wait import WebDriverWait

options = webdriver.ChromeOptions()
options.add_experimental_option("detach", True)
driver: WebDriver = webdriver.Chrome(options=options)
wait = WebDriverWait(driver, 10)


def login_authorise():
    driver.get('https://dkbssy.cg.nic.in/secure/login.aspx')
    driver.maximize_window()
    driver.find_element(By.NAME, "username").send_keys("HOSP22G146659")
    driver.find_element(By.NAME, "password").send_keys("pmjaykorba")
    driver.find_element(By.ID, 'txtCaptcha').click()
    time.sleep(10)  ### SLEEP GIVEN FOR CAPTCHA ENTRY
    sign_in = driver.find_element(By.NAME, "loginbutton")
    sign_in.click()
    # input()
    new_url = 'https://dkbssy.cg.nic.in/secure/incentivemodule/incentivemoduleInitiatedcasesdme.aspx'

    driver.execute_script(f'window.location.href = "{new_url}"')


casear = '''CASE/PS5/HOSP22G146659/R5785502
CASE/PS6/HOSP22G146659/CK6269899
CASE/PS6/HOSP22G146659/CK6355384
CASE/PS5/HOSP22G146659/CK5979669
CASE/PS5/HOSP22G146659/CK5545356
CASE/PS6/HOSP22G146659/CK6427531
CASE/PS6/HOSP22G146659/CK6221441
CASE/PS5/HOSP22G146659/CK5566518
CASE/PS5/HOSP22G146659/S5777377
CASE/PS5/HOSP22G146659/CK5663799
CASE/PS5/HOSP22G146659/S5574923
CASE/PS5/HOSP22G146659/CK5347113
CASE/PS5/HOSP22G146659/S5504309
CASE/PS5/HOSP22G146659/CK5698237
CASE/PS5/HOSP22G146659/CK5667272
CASE/PS5/HOSP22G146659/CK5539172
CASE/PS5/HOSP22G146659/CK5711370
CASE/PS5/HOSP22G146659/CB5764220
CASE/PS5/HOSP22G146659/S5666661
CASE/PS5/HOSP22G146659/CK5731240
CASE/PS5/HOSP22G146659/S5715725
CASE/PS5/HOSP22G146659/CK5461196
CASE/PS5/HOSP22G146659/CK5373968
CASE/PS5/HOSP22G146659/CK5530674
CASE/PS5/HOSP22G146659/CK5488866
CASE/PS5/HOSP22G146659/CK5648939
CASE/PS5/HOSP22G146659/CK5758968
CASE/PS5/HOSP22G146659/CK5664217
CASE/PS5/HOSP22G146659/CK5576103
CASE/PS5/HOSP22G146659/S5586105
CASE/PS5/HOSP22G146659/CK5461154
CASE/PS5/HOSP22G146659/S5511198
CASE/PS5/HOSP22G146659/M5347391
CASE/PS5/HOSP22G146659/CK5327541
CASE/PS5/HOSP22G146659/CK5764125
CASE/PS5/HOSP22G146659/CK5511084
CASE/PS5/HOSP22G146659/CK5465038
CASE/PS5/HOSP22G146659/CK5510825
CASE/PS5/HOSP22G146659/S5563690
CASE/PS5/HOSP22G146659/CK5341790
CASE/PS5/HOSP22G146659/CK5499147
CASE/PS5/HOSP22G146659/CK5589948
CASE/PS5/HOSP22G146659/CK5626438
CASE/PS5/HOSP22G146659/CK5777701
CASE/PS5/HOSP22G146659/CK5562572
CASE/PS5/HOSP22G146659/CB5634825
CASE/PS5/HOSP22G146659/CK5571576
CASE/PS5/HOSP22G146659/M5603234
CASE/PS5/HOSP22G146659/CB5632231
CASE/PS5/HOSP22G146659/CK5594222
CASE/PS5/HOSP22G146659/S5358749
CASE/PS5/HOSP22G146659/R5515918
CASE/PS5/HOSP22G146659/S5383974
CASE/PS5/HOSP22G146659/CK5541907
CASE/PS5/HOSP22G146659/CK5382031
CASE/PS5/HOSP22G146659/CB5322806
CASE/PS5/HOSP22G146659/CK5493975
CASE/PS5/HOSP22G146659/CK5498860
CASE/PS5/HOSP22G146659/CK5498971
CASE/PS5/HOSP22G146659/M5353653
CASE/PS5/HOSP22G146659/CB5483263
CASE/PS5/HOSP22G146659/S5493590
CASE/PS5/HOSP22G146659/R5960513
CASE/PS5/HOSP22G146659/CK5894801
CASE/PS5/HOSP22G146659/CK5891940
CASE/PS5/HOSP22G146659/R5853160
CASE/PS5/HOSP22G146659/R5900365
CASE/PS5/HOSP22G146659/CK5888197
CASE/PS5/HOSP22G146659/CK6009310
CASE/PS5/HOSP22G146659/CK6024304
CASE/PS5/HOSP22G146659/M6062347
CASE/PS5/HOSP22G146659/S5940362
CASE/PS5/HOSP22G146659/CK5893480
CASE/PS5/HOSP22G146659/CK5973691
CASE/PS6/HOSP22G146659/R6337746
CASE/PS5/HOSP22G146659/CK5925619
CASE/PS5/HOSP22G146659/CK6007498
CASE/PS5/HOSP22G146659/CK5872621
CASE/PS5/HOSP22G146659/S5829521
CASE/PS5/HOSP22G146659/CK5894777
CASE/PS6/HOSP22G146659/CK6377619
CASE/PS5/HOSP22G146659/S5828630
CASE/PS5/HOSP22G146659/CK5839213
CASE/PS5/HOSP22G146659/CK6100718
CASE/PS5/HOSP22G146659/M5794407
CASE/PS5/HOSP22G146659/CK5829827
CASE/PS5/HOSP22G146659/S5893975
CASE/PS5/HOSP22G146659/CK6115409
CASE/PS5/HOSP22G146659/CK5925208
CASE/PS5/HOSP22G146659/CK5915163
CASE/PS5/HOSP22G146659/CK6057804
CASE/PS5/HOSP22G146659/CB6126120
CASE/PS5/HOSP22G146659/S5783026
CASE/PS5/HOSP22G146659/S5820219
CASE/PS5/HOSP22G146659/CK5785577
CASE/PS5/HOSP22G146659/CK5786188
CASE/PS5/HOSP22G146659/CK5783597
CASE/PS5/HOSP22G146659/S5783396
CASE/PS5/HOSP22G146659/R5783798
CASE/PS5/HOSP22G146659/R5788605
CASE/PS5/HOSP22G146659/S5790099
CASE/PS5/HOSP22G146659/CK5788570
CASE/PS5/HOSP22G146659/CK5792655
CASE/PS5/HOSP22G146659/CB5793495
CASE/PS5/HOSP22G146659/CK5799324
CASE/PS5/HOSP22G146659/S5799189
CASE/PS5/HOSP22G146659/CB5811663
CASE/PS5/HOSP22G146659/CK5813380
CASE/PS5/HOSP22G146659/CK5813522
CASE/PS5/HOSP22G146659/S5811931
CASE/PS5/HOSP22G146659/CK5820007
CASE/PS5/HOSP22G146659/CB5829595
CASE/PS5/HOSP22G146659/CK5833510
CASE/PS5/HOSP22G146659/CK5833681
CASE/PS5/HOSP22G146659/CK5833719
CASE/PS5/HOSP22G146659/S5838194
CASE/PS5/HOSP22G146659/S5844143
CASE/PS5/HOSP22G146659/CK5844072
CASE/PS5/HOSP22G146659/CK5848243
CASE/PS5/HOSP22G146659/S5852862
CASE/PS5/HOSP22G146659/CK5852867
CASE/PS5/HOSP22G146659/CK5856809
CASE/PS5/HOSP22G146659/S5872246
CASE/PS5/HOSP22G146659/CK5871725
CASE/PS5/HOSP22G146659/CK5894407
CASE/PS5/HOSP22G146659/S5894563
CASE/PS5/HOSP22G146659/CK5900563
CASE/PS5/HOSP22G146659/CK5901562
CASE/PS5/HOSP22G146659/CK5915067
CASE/PS5/HOSP22G146659/R5924572
CASE/PS5/HOSP22G146659/R5925688
CASE/PS5/HOSP22G146659/S5925493
CASE/PS5/HOSP22G146659/S5278271
CASE/PS5/HOSP22G146659/CK5298119
CASE/PS5/HOSP22G146659/S5307671
CASE/PS5/HOSP22G146659/CK5311785
CASE/PS5/HOSP22G146659/CK5313742
CASE/PS5/HOSP22G146659/S5313743
CASE/PS5/HOSP22G146659/CK5321754
CASE/PS5/HOSP22G146659/CK5322582
CASE/PS5/HOSP22G146659/CK5322886
CASE/PS5/HOSP22G146659/S5320339
CASE/PS5/HOSP22G146659/CK5327340
CASE/PS5/HOSP22G146659/S5332255
CASE/PS5/HOSP22G146659/CK5337203
CASE/PS5/HOSP22G146659/CK5341900
CASE/PS5/HOSP22G146659/CK5341912
CASE/PS5/HOSP22G146659/CK5341661
CASE/PS5/HOSP22G146659/CK5341667
CASE/PS5/HOSP22G146659/S5342826
CASE/PS5/HOSP22G146659/CB5342827
CASE/PS5/HOSP22G146659/CK5348914
CASE/PS5/HOSP22G146659/S5347228
CASE/PS5/HOSP22G146659/R5353428
CASE/PS5/HOSP22G146659/CK5357328
CASE/PS5/HOSP22G146659/S5357992
CASE/PS5/HOSP22G146659/S5358719
CASE/PS5/HOSP22G146659/S5359281
CASE/PS5/HOSP22G146659/S5364120
CASE/PS5/HOSP22G146659/CK5364468
CASE/PS5/HOSP22G146659/CK5368464
CASE/PS5/HOSP22G146659/CK5368639
CASE/PS5/HOSP22G146659/S5369172
CASE/PS5/HOSP22G146659/CK5373992
CASE/PS5/HOSP22G146659/S5378640
CASE/PS5/HOSP22G146659/CK5378548
CASE/PS5/HOSP22G146659/CK5378675
CASE/PS5/HOSP22G146659/S5381277
CASE/PS5/HOSP22G146659/S5387370
CASE/PS5/HOSP22G146659/S5460411
CASE/PS5/HOSP22G146659/S5460796
CASE/PS5/HOSP22G146659/CK5468124
CASE/PS5/HOSP22G146659/CK5468245
CASE/PS5/HOSP22G146659/CK5472792
CASE/PS5/HOSP22G146659/CK5477677
CASE/PS5/HOSP22G146659/CK5482553
CASE/PS5/HOSP22G146659/S5481050
CASE/PS5/HOSP22G146659/M5485335
CASE/PS5/HOSP22G146659/CK5487629
CASE/PS5/HOSP22G146659/CK5498784
CASE/PS5/HOSP22G146659/CK5498804
CASE/PS5/HOSP22G146659/S5498749
CASE/PS5/HOSP22G146659/S5499068
CASE/PS5/HOSP22G146659/CK5504182
CASE/PS5/HOSP22G146659/CK5510687
CASE/PS5/HOSP22G146659/CK5514912
CASE/PS5/HOSP22G146659/CK5514967
CASE/PS5/HOSP22G146659/S5523902
CASE/PS5/HOSP22G146659/CK5528125
CASE/PS5/HOSP22G146659/CK5524026
CASE/PS5/HOSP22G146659/S5533483
CASE/PS5/HOSP22G146659/S5533511
CASE/PS5/HOSP22G146659/CK5533186
CASE/PS5/HOSP22G146659/CK5533207
CASE/PS5/HOSP22G146659/CK5535881
CASE/PS5/HOSP22G146659/S5538994
CASE/PS5/HOSP22G146659/CK5545171
CASE/PS5/HOSP22G146659/CK5544647
CASE/PS5/HOSP22G146659/CK5553659
CASE/PS5/HOSP22G146659/CK5561858
CASE/PS5/HOSP22G146659/CK5561874
CASE/PS5/HOSP22G146659/CK5572110
CASE/PS5/HOSP22G146659/CK5575827
CASE/PS5/HOSP22G146659/CK5584884
CASE/PS5/HOSP22G146659/M5589481
CASE/PS5/HOSP22G146659/CK5590548
CASE/PS5/HOSP22G146659/R5594660
CASE/PS5/HOSP22G146659/CK5601919
CASE/PS5/HOSP22G146659/CK5618287
CASE/PS5/HOSP22G146659/CK5621196
CASE/PS5/HOSP22G146659/CK5622351
CASE/PS5/HOSP22G146659/CK5622993
CASE/PS5/HOSP22G146659/CK5626700
CASE/PS5/HOSP22G146659/S5627595
CASE/PS5/HOSP22G146659/S5630236
CASE/PS5/HOSP22G146659/CK5634894
CASE/PS5/HOSP22G146659/CK5634961
CASE/PS5/HOSP22G146659/CK5649268
CASE/PS5/HOSP22G146659/CK5651411
CASE/PS5/HOSP22G146659/CK5655286
CASE/PS5/HOSP22G146659/CK5670026
CASE/PS5/HOSP22G146659/S5685838
CASE/PS5/HOSP22G146659/CK5698484
CASE/PS5/HOSP22G146659/CK5698595
CASE/PS5/HOSP22G146659/S5711039
CASE/PS5/HOSP22G146659/M5718830
CASE/PS5/HOSP22G146659/CK5718980
CASE/PS5/HOSP22G146659/CK5731349
CASE/PS5/HOSP22G146659/M5734887
CASE/PS5/HOSP22G146659/CK5780802
CASE/PS5/HOSP22G146659/CK5786163
CASE/PS5/HOSP22G146659/CK5799371
CASE/PS5/HOSP22G146659/S5807548
CASE/PS5/HOSP22G146659/S5807684
CASE/PS5/HOSP22G146659/CB5813495
CASE/PS5/HOSP22G146659/CB5813681
CASE/PS5/HOSP22G146659/CK5811757
CASE/PS5/HOSP22G146659/CK5811799
CASE/PS5/HOSP22G146659/CK5813339
CASE/PS5/HOSP22G146659/S5828849
CASE/PS5/HOSP22G146659/CK5839454
CASE/PS5/HOSP22G146659/S5839423
CASE/PS5/HOSP22G146659/R5844205
CASE/PS5/HOSP22G146659/CK5844190
CASE/PS5/HOSP22G146659/S5848563
CASE/PS5/HOSP22G146659/CK5861012
CASE/PS5/HOSP22G146659/S5869138
CASE/PS5/HOSP22G146659/S5861668
CASE/PS5/HOSP22G146659/CK5872929
CASE/PS5/HOSP22G146659/CK5876414
CASE/PS5/HOSP22G146659/CK5876934
CASE/PS5/HOSP22G146659/R5887421
CASE/PS5/HOSP22G146659/CK5898647
CASE/PS5/HOSP22G146659/CK5900631
CASE/PS5/HOSP22G146659/CK5905684
CASE/PS5/HOSP22G146659/S5653154
CASE/PS5/HOSP22G146659/R5652962
CASE/PS5/HOSP22G146659/CK5652985
CASE/PS5/HOSP22G146659/CK5654674
CASE/PS5/HOSP22G146659/CK5655093
CASE/PS5/HOSP22G146659/CK5655147
CASE/PS5/HOSP22G146659/CK5659824
CASE/PS5/HOSP22G146659/S5659408
CASE/PS5/HOSP22G146659/CK5664234
CASE/PS5/HOSP22G146659/CK5666857
CASE/PS5/HOSP22G146659/CK5670157
CASE/PS5/HOSP22G146659/S5677346
CASE/PS5/HOSP22G146659/R5678389
CASE/PS5/HOSP22G146659/CK5686187
CASE/PS5/HOSP22G146659/S5685700
CASE/PS5/HOSP22G146659/S5689382
CASE/PS5/HOSP22G146659/CK5690577
CASE/PS5/HOSP22G146659/S5688668
CASE/PS5/HOSP22G146659/CK5698471
CASE/PS5/HOSP22G146659/S5706873
CASE/PS5/HOSP22G146659/R5706531
CASE/PS5/HOSP22G146659/R5713973
CASE/PS5/HOSP22G146659/R5714066
CASE/PS5/HOSP22G146659/S5724183
CASE/PS5/HOSP22G146659/S5735919
CASE/PS5/HOSP22G146659/CK5740312
CASE/PS5/HOSP22G146659/S5740026
CASE/PS5/HOSP22G146659/R5740805
CASE/PS5/HOSP22G146659/S5748860
CASE/PS5/HOSP22G146659/S5749056
CASE/PS5/HOSP22G146659/S5749077
CASE/PS5/HOSP22G146659/S5753000
CASE/PS5/HOSP22G146659/CK5753429
CASE/PS5/HOSP22G146659/R5759155
CASE/PS5/HOSP22G146659/M5771673
CASE/PS5/HOSP22G146659/CK5770840
CASE/PS5/HOSP22G146659/CK5777338
CASE/PS5/HOSP22G146659/M5777317
CASE/PS5/HOSP22G146659/S5777704
CASE/PS5/HOSP22G146659/CB5780624
CASE/PS5/HOSP22G146659/S5909573
CASE/PS5/HOSP22G146659/CK5909160
CASE/PS5/HOSP22G146659/CK5910030
CASE/PS5/HOSP22G146659/CK5915730
CASE/PS5/HOSP22G146659/CK5931264
CASE/PS5/HOSP22G146659/CB5931186
CASE/PS5/HOSP22G146659/S5941018
CASE/PS5/HOSP22G146659/CK5941269
CASE/PS5/HOSP22G146659/CK5942421
CASE/PS5/HOSP22G146659/CK5968598
CASE/PS5/HOSP22G146659/CK5968647
CASE/PS5/HOSP22G146659/CK5968709
CASE/PS5/HOSP22G146659/CK5988162
CASE/PS5/HOSP22G146659/M5992405
CASE/PS5/HOSP22G146659/S5999487
CASE/PS5/HOSP22G146659/M6009210
CASE/PS5/HOSP22G146659/CK6033403
CASE/PS5/HOSP22G146659/CK6034272
CASE/PS5/HOSP22G146659/S6041472
CASE/PS5/HOSP22G146659/CK6051511
CASE/PS5/HOSP22G146659/S6059481
CASE/PS5/HOSP22G146659/CK6074745
CASE/PS5/HOSP22G146659/S6080704
CASE/PS5/HOSP22G146659/CK6092498
CASE/PS5/HOSP22G146659/S6093223
CASE/PS5/HOSP22G146659/S6099969
CASE/PS5/HOSP22G146659/CK6099788
CASE/PS5/HOSP22G146659/CK6100720
CASE/PS5/HOSP22G146659/S6105389
CASE/PS5/HOSP22G146659/CK6114275
CASE/PS5/HOSP22G146659/CK6115441
CASE/PS5/HOSP22G146659/S6115360
CASE/PS5/HOSP22G146659/S6119878
CASE/PS5/HOSP22G146659/S6118474
CASE/PS5/HOSP22G146659/S6130840
CASE/PS5/HOSP22G146659/CK6133300
CASE/PS5/HOSP22G146659/S6148235
CASE/PS6/HOSP22G146659/S6148539
CASE/PS6/HOSP22G146659/CK6152436
CASE/PS6/HOSP22G146659/CK6154464
CASE/PS6/HOSP22G146659/S6157981
CASE/PS6/HOSP22G146659/R6161372
CASE/PS6/HOSP22G146659/CB6168747
CASE/PS6/HOSP22G146659/CK6176564
CASE/PS6/HOSP22G146659/S6181176
CASE/PS6/HOSP22G146659/CK6194967
CASE/PS6/HOSP22G146659/CK6200244
CASE/PS6/HOSP22G146659/CB6200622
CASE/PS6/HOSP22G146659/S6205475
CASE/PS6/HOSP22G146659/S6208718
CASE/PS6/HOSP22G146659/CK6208169
CASE/PS6/HOSP22G146659/S6213224
CASE/PS6/HOSP22G146659/M6215446
CASE/PS6/HOSP22G146659/CK6220615
CASE/PS6/HOSP22G146659/S6220700
CASE/PS6/HOSP22G146659/CK6232405
CASE/PS6/HOSP22G146659/S6238018
CASE/PS6/HOSP22G146659/CK6236914
CASE/PS6/HOSP22G146659/S6239651
CASE/PS6/HOSP22G146659/S6242885
CASE/PS6/HOSP22G146659/CK6245759
CASE/PS6/HOSP22G146659/CK6246734
CASE/PS6/HOSP22G146659/CK6253039
CASE/PS6/HOSP22G146659/S6242650
CASE/PS6/HOSP22G146659/S6255184
CASE/PS6/HOSP22G146659/CK6278495
CASE/PS6/HOSP22G146659/R6300448
CASE/PS6/HOSP22G146659/CK6310644
CASE/PS6/HOSP22G146659/CK6307908
CASE/PS6/HOSP22G146659/CK6317212
CASE/PS6/HOSP22G146659/S6327468
CASE/PS6/HOSP22G146659/M6332803
CASE/PS6/HOSP22G146659/S6332853
CASE/PS6/HOSP22G146659/CK6333203
CASE/PS6/HOSP22G146659/CK6337601
CASE/PS6/HOSP22G146659/CK6348398
CASE/PS6/HOSP22G146659/CK6359507
CASE/PS6/HOSP22G146659/CK6359845
CASE/PS6/HOSP22G146659/CK6361157
CASE/PS6/HOSP22G146659/CK6368560
CASE/PS6/HOSP22G146659/CK6376820
CASE/PS6/HOSP22G146659/CK6384110
CASE/PS6/HOSP22G146659/CK6384336
CASE/PS6/HOSP22G146659/CK6389968
CASE/PS6/HOSP22G146659/CK6392607
CASE/PS6/HOSP22G146659/CK6401042'''.split('\n')


# casear = '''CASE/PS5/HOSP22G146659/S5576070
# CASE/PS6/HOSP22G146659/S7470982
# CASE/PS5/HOSP22G146659/R5574299'''.split('\n')

def authorise_proper(case_number):
    # xemployee_name = ""
    new_new_url = f'https://dkbssy.cg.nic.in/secure/incentivemodule/incentivemoduleViewDME.aspx?ci={case_number}'
    driver.execute_script(f'window.location.href = "{new_new_url}"')
    try:
        wait.until(EC.presence_of_element_located((By.XPATH, '//*[@id="incentiveTableData"]/tr/td[1]')))
        table = wait.until(EC.presence_of_element_located((By.XPATH, '//*[@id="incentiveTableData"]'))).text
        # print(table)
        if "Hema Namdeo" in table:
            if "Dr. Rakesh Kumar Verma" in table:
                return [case_number, 'RH', 'RH']
            return [case_number, 'H', 'H']
        else:
            return [None, case_number, None]
    except (TimeoutException, UnexpectedAlertPresentException) as e:
        return [2, 2, case_number]


count = 0
# missing_lists = []
login_authorise()
# authorise_proper()
for i in casear:
    t1 = time.time()
    # print(count, i)
    z = authorise_proper(i)
    wb = openpyxl.load_workbook(r'G:\My Drive\GdrivePC\Hospital\RSBY\New\Missing.xlsx')
    ws = wb['Sheet1']
    ws.append(z)
    wb.save(r'G:\My Drive\GdrivePC\Hospital\RSBY\New\Missing.xlsx')
    t2 = time.time()
    print(count,round(t2-t1, 2), z)
    # print()
    # time.sleep(1)
    # missing_lists.append(authorise_proper(i))
    count += 1
